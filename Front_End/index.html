<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy_Car_Rent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../src/main/java/lk/easycar/assets/styles/stylesheet.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

</head>
<body>
<!--Header-->

<ul id="navbarList" class="d-flex justify-content-between p-1 mb-3 ">

    <a class=" active" aria-current="page" href="#">Home</a>
    <a class="" href="carManagePage.html">About</a>
    <a class="" href="#">Cars</a>

</ul>
<button id="loginButtonInHome" type="button" class="btn btn-dark"><a href="login.html">Log In</a></button>

<!--Slider-->
<section id="homeSliderSection">
    <img src="../src/main/java/lk/easycar/assets/pageImg/indexPage.jpg" class="img-fluid" alt="mainPage">
</section>

<!--booking button-->
<button id="btnBookingNow" type="button" class="btn btn-warning">Book Now</button>

<!--Cars Context-->
<section id="context">

    <!--sorting button-->
    <section id="sortingButtonArea">
        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
            <input type="radio" class="btn-check" name="allCar" id="btnAllCar" autocomplete="on" checked>
            <label class="btn btn-outline-primary" for="btnAllCar">All</label>

            <input type="radio" class="btn-check" name="allCar" id="btnGeneralCar" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnGeneralCar">General</label>

            <input type="radio" class="btn-check" name="allCar" id="btnLuxuryCar" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnLuxuryCar">Luxury</label>

            <input type="radio" class="btn-check" name="allCar" id="btnPremiumCar" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnPremiumCar">Premium</label>
        </div>
    </section>
    <div id="contextDiv" class="row row-cols-1 row-cols-md-3 g-4">
        <div class="card m-3" style="width: 18rem;">
            <img src="../src/main/java/lk/easycar/assets/carImg/toyota-vitz.jpg" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">Toyota - Vitz</h5>
                <h6>Price(Day)   : Rs.3500</h6>
                <h6>Price(Month) : Rs.35000</h6>
                <h6>Type         : General</h6>
                <h6>Passengers   : 4</h6>
                <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#carModal">Go somewhere</a>

            </div>
        </div>
        <div class="card m-3" style="width: 18rem;">
            <img src="../src/main/java/lk/easycar/assets/pageImg/indexPage.jpg" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                <a href="#" class="btn btn-primary">Go somewhere</a>
            </div>
        </div>
        <div class="card m-3" style="width: 18rem;">
            <img src="../src/main/java/lk/easycar/assets/pageImg/indexPage.jpg" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                <a href="#" class="btn btn-primary">Go somewhere</a>
            </div>
        </div>
        <div class="card m-3" style="width: 18rem;">
            <img src="../src/main/java/lk/easycar/assets/pageImg/indexPage.jpg" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                <a href="#" class="btn btn-primary">Go somewhere</a>
            </div>
        </div>
        <div class="card m-3" style="width: 18rem;">
            <img src="../src/main/java/lk/easycar/assets/pageImg/indexPage.jpg" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                <a href="#" class="btn btn-primary">Go somewhere</a>
            </div>
        </div>
    </div>
</section>

<!--modal-->
<div class="modal fade" id="carModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Booking Form</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div id="carModalBody" class="modal-body">
                <img src="../src/main/java/lk/easycar/assets/carImg/toyota-vitz.jpg" class="card-img-top" style="width: 60%" alt="...">

                <div class="row row-cols-1 row-cols-md-3 g-4" style="top: 10px;width: 61%;position: relative;">
                    <div>
                        <h6>Model</h6>
                        <h5>Toyota-Vitz</h5>
                    </div>
                    <div>
                        <h6>hyyyy</h6>
                        <h5>hyy</h5></div>
                    <div>
                        <h6>Fuel Type</h6>
                        <h5>Petrol</h5>
                    </div>
                    <div>
                        <h6>Color</h6>
                        <h5>Red</h5>
                    </div>
                    <div>
                        <h6>Passengers</h6>
                        <h5>4</h5>
                    </div>
                    <div>
                        <h6>Type</h6>
                        <h5>General</h5>
                    </div>
                    <div>
                        <h6>Free Mileage(Day)</h6>
                        <h5>200</h5>
                    </div>
                    <div>
                        <h6>Free Mileage(Month)</h6>
                        <h5>200</h5>
                    </div>

                </div>
            </div>

            <div id="carPriceContext">
                <div class="m-2" id="perDayPrice">
                    <h6 class="m-2">Per Day</h6>
                    <h5 class="m-2">4500/=</h5>
                </div>
                <div id="perMonthPrice" class="m-2">
                    <h6 class="m-2">Per Month</h6>
                    <h5 class="m-2">55000/=</h5>
                </div>
                <div id="fixPrice" class="m-2">
                    <h6 class="m-2">Fix Price this type</h6>
                    <h5 class="m-2">20000/=</h5>
                </div>
                <div id="paymentInfo" class="m-2">
                    <h6 class="m-2">Bank Details</h6>
                    <h5 class="m-2">Account No : 200033001562</h5>
                    <h5 class="m-2">Beneficiary Name : A.A.T.Oshadha</h5>
                    <h5 class="m-2">Branch : Galle</h5>
                </div>
            </div>

            <form id="bookingForm" >
                <!--date picker-->
                <div class="mb-2">
                    <label for="datePicker" class="form-label m-3">Select Date</label>
                    <input type="date" id="datePicker" name="date">
                </div>
                <!--select booking days-->
                <div class="m-2">
                    <label class="form-label">Select Days</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="btnRadioDay">
                        <label class="form-check-label" for="btnRadioDay">
                            Day
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="btnRadioMonth" checked>
                        <label class="form-check-label" for="btnRadioMonth">
                            Month
                        </label>
                    </div>
                </div>
                <!--select driver-->
                <div class="form-check form-switch m-2">
                    <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" checked>
                    <label class="form-check-label" for="flexSwitchCheckChecked">Hire Driver</label>
                </div>
                <!--upload your receipt-->
                <div class="form-group mb-2 col-6">
                    <label for="uploadBankRec">Upload Bank Slip</label>
                    <input type="file" class="form-control-file" id="uploadBankRec">
                </div>
            </form>
            <div class="modal-footer">
                <button id="btnConfirm" type="button" class="btn btn-primary">Confirm Booking</button>
            </div>
        </div>
    </div>
</div>

<footer>

</footer>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

<script>
    let baseUrl = "http://localhost:8080/cw/"

    var vehiNum="";
    var carSort = "all";
    let carID="";

    getAllCars();
    function getAllCars(){

        let idCount=0;
        $('#context>div').empty();
        $.ajax({
            url:baseUrl+"car",
            success:function (res) {
                console.log("suc car");
                for (let [ i,car ] of res.data.entries()) {
                    console.log("re data");
                    console.log(car);
                    let model = car.model;
                    let type = car.vehicleType;
                    let color = car.color;
                    let transmission = car.transmissionType;
                    let fuel = car.fuelType;
                    let passenger = car.passengers;
                    let dailyPrice = car.dailyPrice;
                    let monthlyPrice = car.monthlyPrice;
                    let freeMileage = car.freeMileage;
                    let vehicleNo = car.vehicleNum;



                    let perCarContext = "<div class=\"card m-3\" style=\"width: 18rem;\">\n" +
                        "            <img src=\"../src/main/java/lk/easycar/assets/carImg/toyota-vitz.jpg\" class=\"card-img-top\" alt=\"...\">\n" +
                        "            <div class=\"card-body\">\n" +
                        "                <h5 id='"+vehicleNo+"' class=\"card-title\">"+model+"</h5>\n" +
                        "                <h6>Price(Day)   : Rs."+dailyPrice+"</h6>\n" +
                        "                <h6>Price(Month) : Rs."+monthlyPrice+"</h6>\n" +
                        "                <h6>Type         : "+type+"</h6>\n" +
                        "                <h6>Passengers   : "+passenger+"</h6>\n" +
                        "                <a href=\"#\" class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#carModal\">Book Now</a>\n" +
                        "\n" +
                        "            </div>\n" +
                        "        </div>"

                    $('#context>div').append(perCarContext);

                    carID=vehicleNo;
                    loadCarModal(carID,i);
                }


            }

        })
    }

    function loadCarModal(carID,i){
        console.log(i)



        $('#context>div>div:nth-child(' + i + ')+>div>a').click(function (){
            /*var id = document.getElementsByTagName();
            console.log("mokaadddddddda");
            console.log(id);*/
            console.log(carID);
            vehiNum=carID;

            let ca = getCarFromNumber(carID);
            console.log("mokaaa");
            console.log(ca[0].vehicleNum);



            let carImg= "<img src=\"../src/main/java/lk/easycar/assets/carImg/toyota-vitz.jpg\" class=\"card-img-top\" style=\"width: 60%\" alt=\"...\">\n"
            let carModalContext = "<div class=\"row row-cols-1 row-cols-md-3 g-4\" style=\"top: 10px;width: 61%;position: relative;\">\n" +
                "                    <div>\n" +
                "                        <h6>Model</h6>\n" +
                "                        <h5>"+ca[0].model+"</h5>\n" +
                "                    </div>\n" +
                "                    <div>\n" +
                "                        <h6>Transmission</h6>\n" +
                "                        <h5>"+ca[0].transmissionType+"</h5></div>\n" +
                "                    <div>\n" +
                "                        <h6>Fuel Type</h6>\n" +
                "                        <h5>"+ca[0].fuelType+"</h5>\n" +
                "                    </div>\n" +
                "                    <div>\n" +
                "                        <h6>Color</h6>\n" +
                "                        <h5>"+ca[0].color+"</h5>\n" +
                "                    </div>\n" +
                "                    <div>\n" +
                "                        <h6>Passengers</h6>\n" +
                "                        <h5>"+ca[0].passengers+"</h5>\n" +
                "                    </div>\n" +
                "                    <div>\n" +
                "                        <h6>Type</h6>\n" +
                "                        <h5>"+ca[0].vehicleType+"</h5>\n" +
                "                    </div>\n" +
                "                    <div>\n" +
                "                        <h6>Free Mileage(Day)</h6>\n" +
                "                        <h5>"+ca[0].freeMileage+"</h5>\n" +
                "                    </div>\n" +
                "                    <div>\n" +
                "                        <h6>Free Mileage(Month)</h6>\n" +
                "                        <h5>"+ca[0].freeMileage+"</h5>\n" +
                "                    </div>\n" +
                "\n" +
                "                </div>"

            let perDay = "<h6 class=\"m-2\">Per Day</h6>\n" +
                "                    <h5 class=\"m-2\">"+ca[0].dailyPrice+"/=</h5>"


            let perMonth = "<h6 class=\"m-2\">Per Month</h6>\n" +
                "                    <h5 class=\"m-2\">"+ca[0].monthlyPrice+"/=</h5>"

            $('#carModalBody').empty();
            $('#perDayPrice').empty();
            $('#perMonthPrice').empty();
            $('#carModalBody').append(carImg);
            $('#carModalBody').append(carModalContext);
            $('#perDayPrice').append(perDay);
            $('#perMonthPrice').append(perMonth);

        });
    }

    /*gett car from vehicle num*/
    function getCarFromNumber(vehicleNum){
        console.log("new : "+vehicleNum);
        let response="";
        $.ajax({
            url: baseUrl+"car",
            dataType:"json",
            async:false,
            success:function (res) {
                response=res.data.filter((c)=>{
                    return c.vehicleNum==vehicleNum;
                });
            }
        });
        return response;
    }

    $('#btnConfirm').click(function (){
        alert(vehiNum);
        let bookingID = "B-001";
        let date = "23/02/2023";
        let time = "12.35";
        let vehicleNum = vehiNum;
        let nic = "2";

        var book = {
            bookingID:bookingID,
            date:date,
            time:time,
            nic:nic,
            vehicleNum:vehicleNum
        }

        $.ajax({
            url:baseUrl+"booking",
            method:"post",
            contentType:"application/json",
            data:JSON.stringify(book),
            dataType: "json",
            success:function (res) {
                alert("success booking"+res.message);

            },
            error:function (error) {
                let cause = JSON.parse(error.responseText).message;
                alert(cause);
            }
        })

    });

    /*Car sorting process*/

    $('#btnAllCar').click(function (){
        carSort="all";
        getAllCars();
    });
    $('#btnGeneralCar').click(function (){
        carSort="General";
        sortCars(carSort);
    });
    $('#btnLuxuryCar').click(function (){
        carSort="Luxury";
        sortCars(carSort);
    });
    $('#btnPremiumCar').click(function (){
        carSort="Premium";
        sortCars(carSort);
    });

    function sortCars(type){
        let t = getCarFromType(type);
        if (t!=null){
            $('#context>div').empty();
            for (let i = 0; i < t.length; i++) {
                let model = t[i].model;
                let type = t[i].vehicleType;
                let color = t[i].color;
                let transmission = t[i].transmissionType;
                let fuel = t[i].fuelType;
                let passenger = t[i].passengers;
                let dailyPrice = t[i].dailyPrice;
                let monthlyPrice = t[i].monthlyPrice;
                let freeMileage = t[i].freeMileage;
                let vehicleNo = t[i].vehicleNum;



                let perCarContext = "<div class=\"card m-3\" style=\"width: 18rem;\">\n" +
                    "            <img src=\"../src/main/java/lk/easycar/assets/carImg/toyota-vitz.jpg\" class=\"card-img-top\" alt=\"...\">\n" +
                    "            <div class=\"card-body\">\n" +
                    "                <h5 id='"+vehicleNo+"' class=\"card-title\">"+model+"</h5>\n" +
                    "                <h6>Price(Day)   : Rs."+dailyPrice+"</h6>\n" +
                    "                <h6>Price(Month) : Rs."+monthlyPrice+"</h6>\n" +
                    "                <h6>Type         : "+type+"</h6>\n" +
                    "                <h6>Passengers   : "+passenger+"</h6>\n" +
                    "                <a href=\"#\" class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#carModal\">Book Now</a>\n" +
                    "\n" +
                    "            </div>\n" +
                    "        </div>"

                $('#context>div').append(perCarContext);

                carID=vehicleNo;
                loadCarModal(carID,i);
            }
        }

    }
    function getCarFromType(vehicleType){

        console.log("new : "+vehicleType);
        let response="";
        $.ajax({
            url: baseUrl+"car?"+vehicleType,
            dataType:"json",
            async:false,
            success:function (res) {
                console.log("success : "+vehicleType);
                response=res.data.filter((c)=>{
                    return c.vehicleType==vehicleType;
                });
            }
        });
        return response;
    }





</script>
</body>

</html>