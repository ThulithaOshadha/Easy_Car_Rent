<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../src/main/java/lk/easycar/assets/styles/stylesheet.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

</head>
<body>
<!--Header-->
<header>
    <ul class="nav justify-content-end shadow p-1 mb-3 bg-e74c3c">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">About</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Cars</a>
        </li>
        <li>
            <nav class="navbar bg-body-tertiary">
                <form class="container-fluid justify-content-start">
                    <button id="loginButtonInHome" class="btn btn-sm btn-outline-secondary" type="button"><a href="login.html">Log In</a></button>
                </form>
            </nav>
        </li>
    </ul>


</header>
<img src="../src/main/java/lk/easycar/assets/pageImg/registerPageImg.png" class="img-fluid" alt="registerPageImg">

<section id="sideContainerInCustomer" class="position-absolute top-10 start-75 translate-middle" style="left: 70%;top: -22%;transform: translate(-50%,57%)!important;">
    <section id="customerManagerForm" class="position-absolute top-10 start-75 translate-middle" style="transform: translate(-50%,57%)!important;">
        <form id="customerForm" class="container text-center">
            <h2>Customer Management Form</h2>
            <div class="row g-2">
                <div class="form-floating mb-3 col-6">
                    <input type="text" class="form-control" id="txtNic" placeholder="NIC : " name="nic">
                    <label for="txtNic">NIC : </label>
                </div>
                <div class="form-floating mb-3 col-6">
                    <input type="text" class="form-control" id="txtName" placeholder="Name :" name="name">
                    <label for="txtName">Name :</label>
                </div>
                <div class="form-floating mb-3 col-6">
                    <input type="text" class="form-control" id="txtAddress" placeholder="address" name="address">
                    <label for="txtAddress">Address</label>
                </div>
                <div class="form-floating mb-3 col-6">
                    <input type="text" class="form-control" id="txtDrivingLicense" placeholder="1003265498" name="license">
                    <label for="txtDrivingLicense">Driving License</label>
                </div>
                <div class="form-floating mb-3 col-6">
                    <input type="text" class="form-control" id="txtContact" placeholder="07111222444" name="contact">
                    <label for="txtContact">Contact No :</label>
                </div>
                <div class="form-floating mb-3 col-6">
                    <input type="password" class="form-control" id="txtPassword" placeholder="07111222444" name="password">
                    <label for="txtContact">Password :</label>
                </div>
                <div class="form-group mb-3 col-6">
                    <label for="uploadNicField">Upload NIC License : </label>
                    <input type="file" class="form-control-file" id="uploadNicField" name="nicImage">
                </div>
                <div class="form-group mb-3 col-6">
                    <label for="uploadLicenseField">Upload Driving License</label>
                    <input type="file" class="form-control-file" id="uploadLicenseField">
                </div>
                <button id="btnCustomerAdd" type="button" class="position-absolute btn btn-primary form-group mb-3 col-6" style="width: 38vw">Register</button>

            </div>

        </form>


    </section>
</section>

<!--<section id="tableSection">
    <table id="customerTable" class="table">
        <thead>
        <tr>
            <th scope="col">NIC</th>
            <th scope="col">Name</th>
            <th scope="col">Address</th>
            <th scope="col">License</th>
            <th scope="col">Contact No</th>
        </tr>
        </thead>
        <tbody id="customerTableBody">
        &lt;!&ndash;<tr>
            <td><%=customer.getNic()%></td>
            <td><%=customer.getName()%></td>
            <td><%=customer.getAddress()%></td>
            <td><%=customer.getContact()%></td>
        </tr>&ndash;&gt;
        </tbody>
        <tfoot>
        ...
        </tfoot>
    </table>
</section>-->



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

<script>
    let baseUrl = "http://localhost:8080/cw/"

    getAllCustomers();
    blindRowClickEvent();


    $('#btnCustomerAdd').click(function () {
       alert("save customer") ;
       let formData = $('#customerForm').serialize();

       $.ajax({
           url:baseUrl+"customer",
           method:"post",
           data:formData,
           dataType:"json",
           success:function (res) {
               res.message;
           },
           error:function (error) {
               alert(JSON.parse(error.responseText).message);
           }
       });
    });

    function getAllCustomers(){
        $('#customerTableBody>tr').empty();
        $.ajax({
            url: baseUrl+"customer",
            success:function (res) {
                for (let c of res.data) {
                    let nic=c.nic;
                    let name=c.name;
                    let address=c.address;
                    let license=c.license;
                    let contact=c.contact;

                    let row = "<tr><td>"+nic+"</td><td>"+name+"</td><td>"+address+"</td><td>"+license+"</td><td>"+contact+"</td></tr>"
                    $('#customerTableBody').append(row);
                }
            }
        });
    };

    function blindRowClickEvent(){
        console.log("blind row");
        $('#customerTableBody').click(function () {
            alert("hii mokaa");
            let nic = $(this).children(":eq(0)").text();
            let name = $(this).children(":eq(1)").text();
            let address =$(this).children(":eq(2)").text();
            let license = $(this).children(":eq(3)").text();

            /*$("#txtNic").val(nic);
            $("#txtName").val(name);
            $("#txtAddress").val(address);
            $("#txtContact").val(license);*/
            $('#txtNic').val(nic);
            $('#txtName').val(name);
            $('#txtAddress').val(address);
            $('#txtContact').val(license);


        });
    }



</script>

</body>
</html>