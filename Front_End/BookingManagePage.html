<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Booking_Manage_Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../src/main/java/lk/easycar/assets/styles/stylesheet.css">
    <link rel="stylesheet" href="../src/main/java/lk/easycar/assets/styles/payment.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

</head>
<body>

<section>
  <div class="row col-4 m-4">
    <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
      <input type="radio" class="btn-check" name="booking" id="btnRequested" autocomplete="on" checked>
      <label class="btn btn-outline-primary" for="btnRequested">Requested Booking</label>

      <input type="radio" class="btn-check" name="booking" id="btnAccepted" autocomplete="off">
      <label class="btn btn-outline-primary" for="btnAccepted">Accepted Booking</label>

    </div>
  </div>
  <div class="row col-10 m-5">
    <table class="table table-striped">
      <thead>
      <tr>
        <th scope="col">Booking ID</th>
        <th scope="col">Date</th>
        <th scope="col">Car</th>
        <th scope="col">Customer</th>
        <th scope="col">Damage Waiver</th>
        <th scope="col">Booking Amount</th>
      </tr>
      </thead>
      <tbody id="bookingTable">

      </tbody>
    </table>
  </div>
</section>

<!--modal-->
<div class="modal fade" id="bookingInfoModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Booking Data</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div id="bookingInfoModalBody" class="modal-body">
        <div class="col-10 m-2">
          <div class="form-floating m-2">
            <input type="text" class="form-control" id="txtBookingID" placeholder="name@example.com">
            <label for="txtBookingID">Booking ID :</label>
          </div>
          <div class="form-floating m-2">
            <input type="text" class="form-control" id="txtDuetDate" placeholder="Password">
            <label for="txtDuetDate">Hand Over Date :</label>
          </div>

        </div>
        <div class="col-10 m-2">
          <div class="form-floating m-2">
            <input type="text" class="form-control" id="txtCarID" placeholder="Password">
            <label for="txtCarID">Vehicle ID :</label>
          </div>
          <div class="form-floating m-2">
            <input type="text" class="form-control" id="txtTotal" placeholder="Password">
            <label for="txtTotal">Driver ID :</label>
          </div>
          <div class="form-floating m-2">
            <input type="text" class="form-control" id="txtCustomer" placeholder="Password">
            <label for="txtCustomer">Customer NIC :</label>
          </div>

        </div>
      </div>
      <div class="modal-footer row">
        <button id="btnConfirm" type="button" class="btn btn-primary col-5">Accepted Booking</button>
        <button id="btnReject" type="button" class="btn btn-danger col-5">Reject Booking</button>

      </div>
    </div>
  </div>
</div>
<!--Payment Modal-->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel1">Booking Data</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div id="paymentModalBody" class="modal-body">
        <div class="container d-lg-flex">
          <div class="box-1 bg-light user">
            <div id="userProfile" class="d-flex align-items-center mb-3">
              <img src="https://images.pexels.com/photos/4925916/pexels-photo-4925916.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500"
                   class="pic rounded-circle" alt="">
              <p class="ps-2 name">Thulitha Oshadha</p>
            </div>
            <div id="carProfile" class="box-inner-1 pb-3 mb-3 ">
              <div class="d-flex justify-content-between mb-3 userdetails">
                <p class="fw-bold">Toyota-Vitz</p>
              </div>
              <div id="my" class="carousel slide carousel-fade img-details" data-bs-ride="carousel"
                   data-bs-interval="2000">
                <div class="carousel-indicators">
                  <button type="button" data-bs-target="#my" data-bs-slide-to="0" class="active"
                          aria-current="true" aria-label="Slide 1"></button>
                  <button type="button" data-bs-target="#my" data-bs-slide-to="1" aria-label="Slide 2"></button>
                  <button type="button" data-bs-target="#my" data-bs-slide-to="2" aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                  <div class="carousel-item active">
                    <img src="https://images.pexels.com/photos/100582/pexels-photo-100582.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500"
                         class="d-block w-100">
                  </div>
                  <div class="carousel-item">
                    <img src="https://images.pexels.com/photos/258092/pexels-photo-258092.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500"
                         class="d-block w-100 h-100">
                  </div>
                  <div class="carousel-item">
                    <img src="https://images.pexels.com/photos/7974/pexels-photo.jpg?auto=compress&cs=tinysrgb&dpr=2&w=500"
                         class="d-block w-100">
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#my" data-bs-slide="prev">
                  <div class="icon">
                    <span class="fas fa-arrow-left"></span>
                  </div>
                  <span class="visually-hidden">Previous</span>
                </button>

                <button class="carousel-control-next" type="button" data-bs-target="#my" data-bs-slide="next">
                  <div class="icon">
                    <span class="fas fa-arrow-right"></span>
                  </div>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
              <div >
                <label  class="box py-2 first">
                  <h6>Vehicle Number </h6>
                  <h5>CAB-4489</h5>
                </label>
                <label class="box py-2 second">
                  <h6>Vehicle Type </h6>
                  <h5>CAB-4489</h5>
                </label>
                <label class="box py-2 third">
                  <h6>Distance(km) </h6>
                  <h5>124</h5>
                </label>
              </div>
            </div>
          </div>
          <div class="box-2">
            <div class="box-inner-2">

              <div >
                <label  class="box py-2 first">
                  <h6>Customer NIC </h6>
                  <h5>CAB-4489</h5>
                </label>
                <label class="box py-2 second">
                  <h6>Customer Name </h6>
                  <h5>CAB-4489</h5>
                </label>
                <label class="box py-2 third">
                  <h6>Damage waiver </h6>
                  <h5>Rs.8000</h5>
                </label>
              </div>

              <div>
                <p class="fw-bold">Payment Details</p>
                <p class="dis mb-3">Complete your purchase by providing your payment details</p>
              </div>
              <form id="paymentForm" action="">
                <div class="mb-3">
                  <p class="dis fw-bold mb-2">Damage</p>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                    <label class="form-check-label" for="flexSwitchCheckDefault">Car Damage Condition</label>
                  </div>
                </div>
                <input type="text" class="form-control" id="txtDamageAmount" aria-describedby="emailHelp" name="userName">


                <!--select payment type-->
                <div class="mb-3">
                  <p class="dis fw-bold mb-2">Select Payment Type</p>
                  <label>
                    <input type="checkbox" class="radio m-2" value="1" name="payment" />Card
                  </label>
                  <label>
                    <input type="checkbox" class="radio m-2" value="1" name="payment" />Cash
                  </label>
                </div>

                <div>

                  <div class="address">
                    <div class="btn btn-primary mt-2">Pay<span class="fas fa-dollar-sign px-1"></span>Rs.8500
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer row">
        <button id="btnConfirmPayment" type="button" class="btn btn-primary col-5">Accepted Booking</button>

      </div>
    </div>
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

<script>

  let baseUrl = "http://localhost:8080/cw/"

  loadBookingTable("false");
  //load();
  let bookingType = "false";
  $('#btnRequested').click(function (){
    bookingType="false";
    loadBookingTable(bookingType);
  });
  $('#btnAccepted').click(function (){
    bookingType="true";
    loadBookingTable(bookingType);
  });
  function loadBookingTable(type) {

    let booking = searchBooking(type);
    console.log("booking");
    console.log(booking);
    loadTable(booking,type)

    /*for (let i = 0; i < ; i++) {

    }*/
  }

  function searchBooking(type){
    //console.log("is "+isAccepted);
    let response = "";
    /*$.ajax({
      url:baseUrl+"booking?accepted="+isAccepted,
      dataType:"json",
      async:false,
      success:function (res) {
        alert("");
        console.log("res.data");
        console.log(res.data);
        console.log(res);
        //loadTable(res);

        response=res.data.filter((c)=>{
          console.log("c");
          console.log(res.data);
          /!*loadTable(res.data)*!/
          return c.accepted==isAccepted;
        })
      }
    });*/

    $.ajax({
      url:baseUrl+"booking",
      dataType:"json",
      async:false,
      success:function (resp) {
        response=resp.data.filter((c)=>{
          return c.accepted==type;
        });
      }

    });
    return response;
  }
  function loadTable(c,type) {
    console.log("car table");
    console.log(type)

    $('#bookingTable').empty();

        for (let car of c) {
          console.log("car");
          console.log(car);
          let bookingID = car.bookingID;
          let carID = car.car.vehicleNum;
          let customerID = car.customer.nic;
          let date = car.dueDate;
          let bookingAmount = car.total;
          let dmgWavier = car.car.vehicleType;
          if (dmgWavier=="Luxury"){
            dmgWavier=20000;
          }else if (dmgWavier=="Premium"){
            dmgWavier=15000;
          }else {
            dmgWavier=10000;
          }

          let row = "<tr><td>" + bookingID + "</td><td>" + date + "</td><td>" + carID + "</td><td>" + customerID + "</td><td>" + dmgWavier + "</td><td>" + bookingAmount + "</td></tr>"
          $('#bookingTable').append(row);
          blindRowClickEventsCar(type,car);

        }



  }
  function blindRowClickEventsCar(type,car) {
    $('#bookingTable>tr').click(function (){
      if (type=="false"){
        $('#bookingInfoModal').modal('show');
        let bookingID=$(this).children(":eq(0)").text();
        let date=$(this).children(":eq(1)").text();
        let car=$(this).children(":eq(2)").text();
        let customer=$(this).children(":eq(3)").text();
        let damageWaiver=$(this).children(":eq(4)").text();
        let bookingAmount=$(this).children(":eq(5)").text();

        $('#txtBookingID').val(bookingID);
        $('#txtDuetDate').val(date);
        $('#txtCarID').val(car);
        $('#txtCustomer').val(customer);
        $('#txtTotal').val(bookingAmount);
        $('#txtDamageAmount').val(damageWaiver);

        $('#btnConfirm').click(function (){
          alert();
          $.ajax({
            url:baseUrl+"booking?bookingID="+bookingID,
            method:"put",
            dataType: "json",
            async: false,
            success:function (res) {
              alert("update accepted");

            }

          })

        })
      }else if (type=="true"){
        $('#paymentModal').modal('show');
        $('#paymentModalBody').empty();
        let vehicleNum = car.car.vehicleNum;
        let vehicleModel = car.car.model;
        let vehicleType = car.car.vehicleType;


        let nic = car.customer.nic;
        let cusName = car.car.name;

        let context = "<div class=\"container d-lg-flex\">\n" +
                "          <div class=\"box-1 bg-light user\">\n" +
                "            <div id=\"userProfile\" class=\"d-flex align-items-center mb-3\">\n" +
                "              <img src=\"https://images.pexels.com/photos/4925916/pexels-photo-4925916.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500\"\n" +
                "                   class=\"pic rounded-circle\" alt=\"\">\n" +
                "              <p class=\"ps-2 name\">"+cusName+"</p>\n" +
                "            </div>\n" +
                "            <div id=\"carProfile\" class=\"box-inner-1 pb-3 mb-3 \">\n" +
                "              <div class=\"d-flex justify-content-between mb-3 userdetails\">\n" +
                "                <p class=\"fw-bold\">"+vehicleModel+"</p>\n" +
                "              </div>\n" +
                "              <div id=\"my\" class=\"carousel slide carousel-fade img-details\" data-bs-ride=\"carousel\"\n" +
                "                   data-bs-interval=\"2000\">\n" +
                "                <div class=\"carousel-indicators\">\n" +
                "                  <button type=\"button\" data-bs-target=\"#my\" data-bs-slide-to=\"0\" class=\"active\"\n" +
                "                          aria-current=\"true\" aria-label=\"Slide 1\"></button>\n" +
                "                  <button type=\"button\" data-bs-target=\"#my\" data-bs-slide-to=\"1\" aria-label=\"Slide 2\"></button>\n" +
                "                  <button type=\"button\" data-bs-target=\"#my\" data-bs-slide-to=\"2\" aria-label=\"Slide 3\"></button>\n" +
                "                </div>\n" +
                "                <div class=\"carousel-inner\">\n" +
                "                  <div class=\"carousel-item active\">\n" +
                "                    <img src=\"https://images.pexels.com/photos/100582/pexels-photo-100582.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500\"\n" +
                "                         class=\"d-block w-100\">\n" +
                "                  </div>\n" +
                "                  <div class=\"carousel-item\">\n" +
                "                    <img src=\"https://images.pexels.com/photos/258092/pexels-photo-258092.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500\"\n" +
                "                         class=\"d-block w-100 h-100\">\n" +
                "                  </div>\n" +
                "                  <div class=\"carousel-item\">\n" +
                "                    <img src=\"https://images.pexels.com/photos/7974/pexels-photo.jpg?auto=compress&cs=tinysrgb&dpr=2&w=500\"\n" +
                "                         class=\"d-block w-100\">\n" +
                "                  </div>\n" +
                "                </div>\n" +
                "                <button class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#my\" data-bs-slide=\"prev\">\n" +
                "                  <div class=\"icon\">\n" +
                "                    <span class=\"fas fa-arrow-left\"></span>\n" +
                "                  </div>\n" +
                "                  <span class=\"visually-hidden\">Previous</span>\n" +
                "                </button>\n" +
                "\n" +
                "                <button class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#my\" data-bs-slide=\"next\">\n" +
                "                  <div class=\"icon\">\n" +
                "                    <span class=\"fas fa-arrow-right\"></span>\n" +
                "                  </div>\n" +
                "                  <span class=\"visually-hidden\">Next</span>\n" +
                "                </button>\n" +
                "              </div>\n" +
                "              <div >\n" +
                "                <label  class=\"box py-2 first\">\n" +
                "                  <h6>Vehicle Number </h6>\n" +
                "                  <h5>"+vehicleNum+"</h5>\n" +
                "                </label>\n" +
                "                <label class=\"box py-2 second\">\n" +
                "                  <h6>Vehicle Type </h6>\n" +
                "                  <h5>"+vehicleType+"</h5>\n" +
                "                </label>\n" +
                "                <label class=\"box py-2 third\">\n" +
                "                  <h6>Distance(km) </h6>\n" +
                "                  <h5>124</h5>\n" +
                "                </label>\n" +
                "              </div>\n" +
                "            </div>\n" +
                "          </div>\n" +
                "          <div class=\"box-2\">\n" +
                "            <div class=\"box-inner-2\">\n" +
                "\n" +
                "              <div >\n" +
                "                <label  class=\"box py-2 first\">\n" +
                "                  <h6>Customer NIC </h6>\n" +
                "                  <h5>"+nic+"</h5>\n" +
                "                </label>\n" +
                "                <label class=\"box py-2 second\">\n" +
                "                  <h6>Customer Name </h6>\n" +
                "                  <h5>"+cusName+"</h5>\n" +
                "                </label>\n" +
                "                <label class=\"box py-2 third\">\n" +
                "                  <h6>Damage waiver </h6>\n" +
                "                  <h5>Rs.8000</h5>\n" +
                "                </label>\n" +
                "              </div>\n" +
                "\n" +
                "              <div>\n" +
                "                <p class=\"fw-bold\">Payment Details</p>\n" +
                "                <p class=\"dis mb-3\">Complete your purchase by providing your payment details</p>\n" +
                "              </div>\n" +
                "              <form id=\"paymentForm\" action=\"\">\n" +
                "                <div class=\"mb-3\">\n" +
                "                  <p class=\"dis fw-bold mb-2\">Damage</p>\n" +
                "                  <div class=\"form-check form-switch\">\n" +
                "                    <input class=\"form-check-input\" type=\"checkbox\" role=\"switch\" id=\"flexSwitchCheckDefault\">\n" +
                "                    <label class=\"form-check-label\" for=\"flexSwitchCheckDefault\">Car Damage Condition</label>\n" +
                "                  </div>\n" +
                "                </div>\n" +
                "                <input type=\"text\" class=\"form-control\" id=\"txtDamageAmount\" aria-describedby=\"emailHelp\" name=\"userName\">\n" +
                "\n" +
                "\n" +
                "                <!--select payment type-->\n" +
                "                <div class=\"mb-3\">\n" +
                "                  <p class=\"dis fw-bold mb-2\">Select Payment Type</p>\n" +
                "                  <label>\n" +
                "                    <input type=\"checkbox\" class=\"radio m-2\" value=\"1\" name=\"payment\" />Card\n" +
                "                  </label>\n" +
                "                  <label>\n" +
                "                    <input type=\"checkbox\" class=\"radio m-2\" value=\"1\" name=\"payment\" />Cash\n" +
                "                  </label>\n" +
                "                </div>\n" +
                "\n" +
                "                <div>\n" +
                "\n" +
                "                  <div class=\"address\">\n" +
                "                    <div class=\"btn btn-primary mt-2\">Pay<span class=\"fas fa-dollar-sign px-1\"></span>Rs.8500\n" +
                "                    </div>\n" +
                "                  </div>\n" +
                "                </div>\n" +
                "              </form>\n" +
                "            </div>\n" +
                "          </div>\n" +
                "        </div>"


        $('#paymentModalBody').append(context);


        var paymentOB = {
          bookingID:car.bookingID,
          booking:car,
          rent:car.total,
          account:"266466",
          paymentMethod:"card",
          deduction:2000
        }
        console.log("paymentOB");
        console.log(paymentOB);
      }


    })
  }






</script>

</body>
</html>