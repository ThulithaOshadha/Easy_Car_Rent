<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Car_Manage_Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../src/main/java/lk/easycar/assets/styles/stylesheet.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

</head>
<body>
<!--Header-->
<header>
    <ul class="nav justify-content-end shadow p-1 mb-3 bg-e74c3c">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">About</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Cars</a>
        </li>
        <li>
            <nav class="navbar bg-body-tertiary">
                <form class="container-fluid justify-content-start">
                    <button id="loginButtonInHome" class="btn btn-sm btn-outline-secondary" type="button"><a
                            href="login.html">Log In</a></button>
                </form>
            </nav>
        </li>
    </ul>


</header>
<!--car page image-->
<form action="" id="carsAddingForm" class="container text-center">
    <h2 class="mb-3">Car Management Form</h2>
    <div class="row g-2">
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtVehicleNo" placeholder="Vehicle No :" name="vehicleNum">
            <label for="txtVehicleNo">Vehicle No :</label>
        </div>
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtModel" placeholder="Model" name="model">
            <label for="txtModel">Model :</label>
        </div>
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtVehicleType" placeholder="Vehicle Type" name="vehicleType">
            <label for="txtVehicleType">Vehicle Type : </label>
        </div>
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtTransmission" placeholder="Transmission Type" name="transmissionType">
            <label for="txtTransmission">Transmission Type :</label>
        </div>

        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtColor" placeholder="Color :" name="color">
            <label for="txtColor">Color :</label>
        </div>
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtFuelType" placeholder="Fuel Type" name="fuelType">
            <label for="txtFuelType">Fuel Type :</label>
        </div>
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtPassengers" placeholder="Passengers" name="passengers">
            <label for="txtPassengers">Passengers : </label>
        </div>
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtMonthlyPrice" placeholder="Monthly Price" name="monthlyPrice">
            <label for="txtMonthlyPrice">Monthly Price :</label>
        </div>

        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtDailyPrice" placeholder="Daily Price :" name="dailyPrice">
            <label for="txtDailyPrice">Daily Price :</label>
        </div>
        <div class="form-floating mb-3 col-6">
            <input class="form-control" id="txtFreeMileage" placeholder="Free Mileage" name="freeMileage">
            <label for="txtFreeMileage">Free Mileage :</label>
        </div>
        <div class="form-group mb-3 col-6">
            <label for="exampleFormControlFile1">Upload Car Images</label>
            <input type="file" class="form-control-file" id="exampleFormControlFile1">
        </div>
        <div class="col-auto col-6">
            <button type="button" id="btnAddPhoto" class="btn btn-primary mb-3">Add photo</button>
        </div>

        <div id="carImageImages" style="display: inline-block">
            <!--<img src="" class="img-thumbnail"style="width: 100px" alt="...">
            <img src="../java/lk/easycar/assets/car1.jpg" class="img-thumbnail"style="width: 100px" alt="...">
            <img src="../java/lk/easycar/assets/car1.jpg" class="img-thumbnail"style="width: 100px" alt="...">
            <img src="../java/lk/easycar/assets/car1.jpg" class="img-thumbnail"style="width: 100px" alt="...">-->
        </div>

        <div class="form-floating mb-3">
            <label for="txtAvailability">Availability : </label>
            <input type="" class="form-control" id="txtAvailability" placeholder="Availability" name="available">

        </div>

        <div id="saveButtonArea" style="right: 223px;position: relative;top: 48px;"></div>

    </div>


</form>
<img id="carAddingImg" src="../src/main/java/lk/easycar/assets/pageImg/carAddingImg.jpg" class="img-fluid"
     alt="carPage"><!--car manage form-->

<!--Cars Table-->

<table id="carTable" class="table">
    <thead>
    <tr>
        <th scope="col">Model</th>
        <th scope="col">Type</th>
        <th scope="col">Color</th>
        <th scope="col">Transmission</th>
        <th scope="col">Fuel</th>
        <th scope="col">Passengers</th>
        <th scope="col">Daily Price</th>
        <th scope="col">Monthly Price</th>
        <th scope="col">Free mileage</th>
        <th scope="col">Vehicle No</th>

    </tr>
    </thead>
    <tbody id="carTableBody">
    </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

<script>
    let baseUrl = "http://localhost:8080/cw/"

    let tableClick = false;
    checkTableClick();
    loadCarsTable();
    blindRowClickEventsCar();


    function checkTableClick() {
        if (tableClick == false) {
            $('#saveButtonArea').empty();
            $('#saveButtonArea').append(
                "<button id=\"btnCarSave\" type=\"button\" class=\"position-absolute top-110 start-40 btn btn-primary mb-2\" style=\"width: 29vw;position: relative;bottom: 5px\">Save</button>"
            )
        } else if (tableClick==true) {
            $('#saveButtonArea').empty();
            $('#saveButtonArea').append(
                "<button id=\"btnCarUpdate\" type=\"button\" class=\"position-absolute top-110 start-40 btn btn-danger mb-2\" style=\"width: 29vw;position: relative;bottom: 5px\">Update</button>"

            )
            updateCar();
        }
    }

    let carsAddingCount = 0;


    $('#btnAddPhoto').click(function () {
        if (carsAddingCount < 4) {
            alert("Hiii");
            console.log("sdfsdfsd");
            let i = "src/main/java/lk/easycar/assets/driver_management.jpg";
            $('#carImageImages').append("<img src='../java/lk/easycar/assets/car_management.jpg' class='img-thumbnail mb-3' alt='car'/>")
            carsAddingCount++
            console.log(carsAddingCount);
        }
    });

    $('#btnCarSave').click(function () {
        if (tableClick==false){
            alert("saved car");
            let formData = $('#carsAddingForm').serialize();
            $.ajax({
                url: baseUrl + "car",
                method: "post",
                data: formData,
                dataType: "json",
                success: function (res) {
                    res.message
                    loadCarsTable();
                    blindRowClickEventsCar();
                    clearTextFields();
                },
                error: function (error) {
                    alert(JSON.parse(error.responseText).message);
                }
            });
        }else if (tableClick==true){
            alert("hii update");
        }

    });


    function loadCarsTable() {
        $('#carTableBody').empty();
        console.log("blind row in car");
       /* $('#carTableBody').empty();*/
        $.ajax({
            url: baseUrl + "car",
            success: function (res) {
                for (let car of res.data) {
                    let model = car.model;
                    let type = car.vehicleType;
                    let color = car.color;
                    let transmission = car.transmissionType;
                    let fuel = car.fuelType;
                    let passenger = car.passengers;
                    let dailyPrice = car.dailyPrice;
                    let monthlyPrice = car.monthlyPrice;
                    let freeMileage = car.freeMileage;
                    let vehicleNo = car.vehicleNum;

                    let row = "<tr><td>" + model + "</td><td>" + type + "</td><td>" + color + "</td><td>" + transmission + "</td><td>" + fuel + "</td><td>" + passenger + "</td><td>" + dailyPrice + "</td><td>" + monthlyPrice + "</td><td>" + freeMileage + "</td><td>" + vehicleNo + "</td></tr>"
                    $('#carTableBody').append(row);
                    //blindRowClickEventsCar();

                }
                blindRowClickEventsCar();
            }
        });

    };

    function blindRowClickEventsCar() {
        $('#carTableBody>tr').click(function () {
        /*$("#carTableBody").on("click","tr",function(){*/
            alert("hi");
            tableClick = true;
            checkTableClick();
            let vehicleNum = $(this).children(":eq(9)").text();
            let model = $(this).children(":eq(0)").text();
            let type = $(this).children(":eq(1)").text();
            let color = $(this).children(":eq(2)").text();
            let transmission = $(this).children(":eq(3)").text();
            let fuel = $(this).children(":eq(4)").text();
            let passenger = $(this).children(":eq(5)").text();
            let dailyPrice = $(this).children(":eq(6)").text();
            let monthlyPrice = $(this).children(":eq(7)").text();
            let freeMileage = $(this).children(":eq(8)").text();


            $('#txtVehicleNo').val(vehicleNum);
            $('#txtModel').val(model);
            $('#txtVehicleType').val(type);
            $('#txtTransmission').val(transmission);
            $('#txtColor').val(color);
            $('#txtFuelType').val(fuel);
            $('#txtPassengers').val(passenger);
            $('#txtMonthlyPrice').val(monthlyPrice);
            $('#txtDailyPrice').val(dailyPrice);
            $('#txtFreeMileage').val(freeMileage);

        });
    };

    function updateCar(){
        $('#btnCarUpdate').click(function(){
            alert('updated now');
            let vehicleNum = $("#txtVehicleNo").val();
            let model = $("#txtModel").val();
            let type = $("#txtVehicleType").val();
            let transmission = $("#txtTransmission").val();
            let color = $("#txtColor").val();
            let fuelType = $("#txtFuelType").val();
            let passenger = $("#txtPassengers").val();
            let monthlyPrice = $("#txtMonthlyPrice").val();
            let dailyPrice = $("#txtDailyPrice").val();
            let freeMileage = $("#txtFreeMileage").val();
            let available = $("#txtAvailability").val();

            var car = {
                vehicleNum:vehicleNum,
                model:model,
                vehicleType:type,
                transmissionType:transmission,
                color:color,
                fuelType:fuelType,
                passengers:passenger,
                monthlyPrice:monthlyPrice,
                dailyPrice:dailyPrice,
                freeMileage:freeMileage,
                available:available
            }

            $.ajax({
               url:baseUrl+"car",
               method: "put",
               contentType:"application/json",
               data: JSON.stringify(car),
                dataType: "json",
                success:function (res) {
                    alert(res.message);
                    loadCarsTable();
                    tableClick=false;
                    checkTableClick();
                    clearTextFields();
                },
                error:function (error) {
                    let cause=JSON.parse(error.responseText).message;
                    alert(cause);
                }
            });
        });
    };

    function clearTextFields(){
        $('#txtVehicleNo').val("");
        $('#txtModel').val("");
        $('#txtVehicleType').val("");
        $('#txtTransmission').val("");
        $('#txtColor').val("");
        $('#txtFuelType').val("");
        $('#txtPassengers').val("");
        $('#txtMonthlyPrice').val("");
        $('#txtDailyPrice').val("");
        $('#txtFreeMileage').val("");
    };




</script>

</body>
</html>